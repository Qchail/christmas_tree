# 🎄 Christmas Tree

一个基于 Three.js 和 MediaPipe 的交互式 3D 圣诞树项目，支持手势控制和照片上传功能。

## ✨ 功能特性

### 🎨 视觉效果
- **3D 粒子圣诞树**：使用粒子系统构建的圆锥形圣诞树，带有发光效果
- **五角星装饰**：树顶金色五角星，带有光源效果
- **雪花飘落**：动态雪花粒子系统
- **金箔碎片**：彩色金箔碎片飘落效果（黄色、绿色、红色）
- **圣诞球装饰**：金色、红色、蓝色金属质感装饰球
- **螺旋光带**：缠绕在树上的金色螺旋光带，带有闪光效果
- **照片卡片**：可上传照片并显示在 3D 场景中

### 🎮 交互功能
- **手势控制**：使用 MediaPipe Hands 进行手势识别
  - 张开手掌：触发元素散开动画
  - 握拳：触发元素聚集动画
- **照片管理**：
  - 支持上传最多 40 张照片
  - 单张照片最大 25MB
  - 自动图片压缩优化
  - 使用 IndexedDB 本地存储
- **相机控制**：
  - 自动旋转（可配置速度）
  - 鼠标/触摸控制（OrbitControls）
  - 散开/聚集时的动态相机调整

### 🎵 音频
- 背景音乐播放（圣诞歌曲）

## 🚀 快速开始

### 环境要求
- Node.js 16+ 
- npm 或 yarn

### 安装依赖

```bash
# 使用 npm
npm install

# 或使用 yarn
yarn install
```

### 开发模式

```bash
# 使用 npm
npm run dev

# 或使用 yarn
yarn dev
```

开发服务器将在 `http://localhost:5173` 启动（默认 Vite 端口）。

### 构建生产版本

```bash
# 使用 npm
npm run build

# 或使用 yarn
yarn build
```

构建产物将输出到 `dist` 目录。

### 预览生产版本

```bash
# 使用 npm
npm run preview

# 或使用 yarn
yarn preview
```

## 📦 使用说明（小白指南）

如果你已经拿到了构建好的 `dist` 目录，使用方法非常简单：

### 🎯 直接打开使用（最简单）

1. **找到 `dist` 目录**：打开你下载或收到的 `dist` 文件夹
2. **双击打开**：找到 `index.html` 文件，双击打开
3. **允许权限**：浏览器会请求摄像头权限，点击"允许"即可
4. **开始使用**：现在你可以：
   - 查看 3D 圣诞树
   - 使用手势控制（张开手掌散开，握拳聚集）
   - 上传照片装饰圣诞树

就这么简单！🎉

### 💡 使用提示

- **浏览器选择**：建议使用 Chrome 或 Edge 浏览器，体验最佳
- **摄像头权限**：首次使用需要允许浏览器访问摄像头，用于手势识别
- **手势控制**：确保摄像头已连接并正常工作
- **照片上传**：上传的照片会保存在浏览器的本地存储中，刷新页面不会丢失

## 📁 项目结构

```
christmas_tree/
├── public/
│   └── bgm/
│       └── christmas song.MP3    # 背景音乐
├── src/
│   ├── config.js                 # 配置文件（粒子、装饰等参数）
│   ├── gesture.js                # 手势控制模块
│   └── main.js                   # 主程序入口
├── index.html                    # HTML 入口文件
├── vite.config.ts               # Vite 配置文件
└── package.json                  # 项目依赖配置
```

## ⚙️ 配置说明

所有视觉效果和交互参数都在 `src/config.js` 中配置，包括：

- **粒子系统**：粒子数量、大小、颜色、发光效果
- **装饰元素**：五角星、雪花、金箔、圣诞球、螺旋光带等参数
- **照片卡片**：数量限制、文件大小限制、压缩设置
- **相机控制**：旋转速度、散开/聚集动画参数

详细配置项请查看 `src/config.js` 文件中的注释。

## 🎯 使用说明

### 手势控制

1. **允许摄像头权限**：首次使用需要允许浏览器访问摄像头
2. **张开手掌**：所有装饰元素会散开，相机视角会拉远
3. **握拳**：所有装饰元素会聚集回圣诞树，相机视角恢复正常

### 照片上传

1. 点击界面上的照片上传按钮
2. 选择要上传的照片（支持 JPG、PNG 等常见格式）
3. 照片会自动压缩并存储到本地 IndexedDB
4. 照片会以卡片形式显示在 3D 场景中
5. 可以删除已上传的照片

## 🛠️ 技术栈

- **Three.js** (`^0.160.0`) - 3D 图形渲染
- **MediaPipe Hands** (`^0.4.1675469240`) - 手势识别
- **Vite** (`^5.0.0`) - 构建工具和开发服务器
- **IndexedDB** - 本地数据存储

## 📝 开发说明

### MediaPipe 资源处理

项目使用自定义 Vite 插件处理 MediaPipe 资源：
- 构建时将 MediaPipe 资源转换为 data URI
- 注入 fetch polyfill 以支持 data URI 加载
- 确保在生产环境中正确加载 MediaPipe 模型

### 照片存储

- 使用 IndexedDB 存储照片数据（替代 localStorage，支持更大存储）
- 自动从 localStorage 迁移旧数据（一次性迁移）
- 支持图片压缩以减少存储空间

## 🌐 浏览器兼容性

- Chrome/Edge（推荐，最佳 MediaPipe 支持）
- Firefox
- Safari（部分功能可能受限）

**注意**：手势识别功能需要摄像头权限，建议在 HTTPS 环境下使用。

## 📄 许可证

MIT License

## 🙏 致谢

- [Three.js](https://threejs.org/) - 强大的 3D 图形库
- [MediaPipe](https://mediapipe.dev/) - Google 的手势识别解决方案

---

🎅 祝你圣诞快乐！Merry Christmas! 🎄
